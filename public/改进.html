<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="theme-color" content="#000000" />
    <title>改进</title>
    <style>
      div {
        color: red;
      }
    </style>
  </head>
  <body>
    <div id="addCount">计数器： 0</div>
    <button id="openBtn">通过window open打开弹窗</button>
    <script>
      let count = 0;

      const childCount = document.createElement("div");

      openBtn.onclick = () => {
        const externalWindow = window.open("", "modal", "width=300,height=300");
        externalWindow.document.body.appendChild(childCount);
        // 将父窗口样式复制到子窗口
        externalWindow.document.head.appendChild(window.document.head.cloneNode(true))
        // 每次打开子窗口都重新绑定事件
        childCount.onclick = () => {
          count++;
          console.log("点击子窗口：", count);
          render();
        };
        render();
      };

      addCount.onclick = () => {
        count++;
        console.log("点击父窗口：", count);
        render();
      };

      const render = () => {
        addCount.innerText = `计数器：${count}`;
        childCount.innerText = `计数器：${count}`;
      };
    </script>
  </body>
</html>
